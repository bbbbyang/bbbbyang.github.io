<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Let's Talk About Web Server | Bingyang</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon-32.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Let's Talk About Web Server</h1><a id="logo" href="/.">Bingyang</a><p class="description">总有人把你推向阳光</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Let's Talk About Web Server</h1><div class="post-meta">Apr 13, 2022<span> | </span><span class="category"><a href="/categories/Java/">Java</a></span></div><div class="post-content"><p>Apache, Tomcat, Jetty, Spring, SparkJava. When a beginner starts a backend application, frameworks take care everything, we don’t need to care about how it works just focus on the API programming which is good and bad. I want to talk about them from my understanding, my learning path.</p>
<h3 id="What-is-a-server"><a href="#What-is-a-server" class="headerlink" title="What is a server"></a>What is a server</h3><p>When I start my work for SiriusXM, I did a lot of network IO work involved lots of TCP connections (Client/Server). At that time, I don’t even touch HTTP server. Server is not only meaning web/HTTP server. For me, the server means a pure TCP server, it can be database server, or websocket server or any computer you can get a response.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sock = socket(AF_INET,SOCK_STREAM,0);</span><br><span class="line">int ret = bind(sock, port); // bind port</span><br><span class="line">ret = listen(sock,1); // listen</span><br><span class="line">connfd = accept(sock, client, client_addrlength); // accept connection</span><br><span class="line">int fd = open(&quot;hello.html&quot;,O_RDONLY);</span><br><span class="line">sendfile(connfd,fd,NULL,2500); // send response</span><br></pre></td></tr></table></figure>
<p>This is a simple TCP server which does not handle HTTP and just return a HTML file. However when you connect to this server through a browser, it will still get HTML file back and see the HTML content. So the core of the web HTTP server is just a TCP server return a HTML file.</p>
<h3 id="Apache"><a href="#Apache" class="headerlink" title="Apache"></a>Apache</h3><p>The HTTP is a protocal which define the rules how client and server communicate with each other and transfer data, like only client can fire a connection to server then server will give response back, etc. We often compared it with websocket. HTTP can be not only used in web browser, it can be used any application. HTTP connection can be considered 3 steps. First is to establish a TCP connection. Second client generates HTTP format request and send to server. Last server sends back HTTP format response to client.</p>
<p>Apache is a widely used HTTP server. Apache has a process of URI Translation, it will translate the URL to find which resource it looking for and return the file, such as HTML, tar, etc. It kinda looks like what we did before, return a file but the pure TCP server does not have ability to analysis URL, the server can only accept the connection with the hostname and port. What’s more, apache can analysis more based on HTTP protocal.</p>
<p>It can only provide static content. For a web serverm, all web page needs to be written and placed in the designate path.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">                request</span><br><span class="line">web broswer     ------&gt;       HTTP server</span><br><span class="line">                               get file</span><br><span class="line">                &lt;------</span><br><span class="line">                response</span><br></pre></td></tr></table></figure></p>
<p><em>When we hit <code>http://laravel.com</code>, Apache analyse the request information knows that we didn’t specify a file, so it looks for a directory index and finds <code>index.php</code>. <code>.php</code> file should send to PHP app. Then Apache receives the output from PHP and sends it back over the Internet to a user’s web browser.</em></p>
<h3 id="Tomcat-Jetty"><a href="#Tomcat-Jetty" class="headerlink" title="Tomcat/Jetty"></a>Tomcat/Jetty</h3><p>Static content is not enough for complex web service, and we need dynamic content. Also when we have complicated web service and we don’t want to couple web service with HTTP server. HTTP server should not be responsible for finding the right service to ask for content. As a result, we define a abstract layer, which are interfaces for Java application, Servlet.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">               request</span><br><span class="line">web broswer    ------&gt;     HTTP server   -----&gt;    Servlet   ----&gt;   service</span><br><span class="line">               &lt;------                   &lt;-----              &lt;----</span><br><span class="line">               response</span><br></pre></td></tr></table></figure></p>
<p>This is not completely right, it is easy to understand. Servelets need to be deployed in Servlet container. Servlet container will find right servlet for the request.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public interface Servlet &#123;</span><br><span class="line">    void init(ServletConfig config) throws ServletException;</span><br><span class="line">    ServletConfig getServletConfig();</span><br><span class="line">    void service(ServletRequest req, ServletResponse res）throws ServletException, IOException;</span><br><span class="line">    String getServletInfo();</span><br><span class="line">    void destroy();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>For a simple example, we can inherit HttpServlet and implement service we want and map and request with corresponding services in web.xml. Then we deploy these into web container. Tomcat and Jetty is a web container (HTTP server plus servlet container).</p>
<p>In constructing response, we can put data from dababase in to it.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123;</span><br><span class="line">    PrintWriter out = response.getWriter();</span><br><span class="line">    response.setContentType(&quot;text/html;charset=utf-8&quot;);</span><br><span class="line">    out.println(&quot;&lt;HTML&gt;My Servlet!&quot;);</span><br><span class="line">    out.println(data);</span><br><span class="line">    out.println(&quot;&lt;/HTML&gt;&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>For now, all frontend pages are generated from backend and sent to web browser. It is heavy load. Nowadays, we separate frontend and backend. Frontend like Angular/React call backend endpoint to get data. Backend only return json instead of the whole HTML page.</p>
<p><em>Like PHP/ASP, Java provides JSP to generate HTML from backend. Developer can write Java code in HTML style template and generate HTML file. JSP is a wrapped servlet, we don’t talk too much here.</em></p>
<h3 id="Other-Framework"><a href="#Other-Framework" class="headerlink" title="Other Framework"></a>Other Framework</h3><p>Spring wraps tomcat and SparkJava uses Jetty. SpringMVC is based on servlet. If we don’t know what is servlet and how does it work, it is hard to understand <a href="https://stackify.com/spring-mvc/" target="_blank" rel="noopener">SpringMVC</a>. If there is anything wrong here, please let me know by email.</p>
</div><div class="tags"><a href="/tags/Web-Server/">Web Server</a></div><div class="post-nav"><a class="next" href="/2021/11/08/Dynamic-Programming/">Dynamic Programming</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Algorithm/">Algorithm</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/C/">C++</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Design-Pattern/">Design Pattern</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Protocol/">Protocol</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/algorithm/">algorithm</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/DIP/" style="font-size: 15px;">DIP</a> <a href="/tags/DP/" style="font-size: 15px;">DP</a> <a href="/tags/AOP/" style="font-size: 15px;">AOP</a> <a href="/tags/HashTable/" style="font-size: 15px;">HashTable</a> <a href="/tags/Interface/" style="font-size: 15px;">Interface</a> <a href="/tags/Polymorphism/" style="font-size: 15px;">Polymorphism</a> <a href="/tags/Annotation/" style="font-size: 15px;">Annotation</a> <a href="/tags/Web-Server/" style="font-size: 15px;">Web Server</a> <a href="/tags/OAuth/" style="font-size: 15px;">OAuth</a> <a href="/tags/Mean-Shift/" style="font-size: 15px;">Mean Shift</a> <a href="/tags/TLS/" style="font-size: 15px;">TLS</a> <a href="/tags/View/" style="font-size: 15px;">View</a> <a href="/tags/Deep-copy/" style="font-size: 15px;">Deep copy</a> <a href="/tags/NIO/" style="font-size: 15px;">NIO</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Links</i></div><ul></ul><a target="_blank"></a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer"><div><!--span#busuanzi_container_site_pv//span= ' '
//span#busuanzi_value_site_pv
//span(rel='nofollow')= ' ' + __(' HITS, ')--><span id="busuanzi_container_site_uv"><span id="busuanzi_value_site_uv"></span><span rel="nofollow">  VISITORS.</span></span></div>BINGYANG © 2022 刘冰洋 | HEADING TO THE FUTURE<br><a class="fa fa-github fa-2x" rel="nofollow" target="_blank" href="https://github.com/bbbbyang"></a> &nbsp; <a class="fa fa-linkedin fa-2x" rel="nofollow" target="_blank" href="https://www.linkedin.com/in/bingyang-liu-451b7976/"></a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script></div></body></html>